<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»‘å½±çŒœé¡ŒéŠæˆ²</title>
    <!-- ä½¿ç”¨æ›´ç©©å®šçš„ CDN é€£çµ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: radial-gradient(circle, #1a1a2e 0%, #16213e 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            overflow-x: hidden;
        }

        .game-container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* æ‹¼åœ–å€å®¹å™¨ - é‡é»æ”¾å¤§ */
        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 0; 
            background-color: #000;
            position: relative;
            aspect-ratio: 4 / 3;
            border: 6px solid #ffd700;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            border-radius: 12px;
            overflow: hidden;
            width: 100%;
        }

        /* ç•¶ç­”æ¡ˆé¡¯ç¤ºæ™‚ï¼Œå¼·åˆ¶éš±è—æ‰€æœ‰é»‘å¹• */
        .puzzle-grid.reveal-all .mask-cell {
            opacity: 0 !important;
        }

        .painting-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: 0;
            display: none; 
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            z-index: 5;
            color: #ffd700;
            text-align: center;
            font-weight: bold;
            padding: 20px;
        }

        .mask-cell {
            background-color: #000;
            z-index: 10;
            margin: -1px; 
            transition: opacity 0.8s ease-out, transform 0.6s ease;
            border: 0.1px solid rgba(255,255,255,0.03);
        }

        .mask-cell.revealed {
            opacity: 0;
            pointer-events: none;
            transform: scale(1.1);
        }

        .progress-bar-container {
            width: 100%;
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4d4d, #f9ca24);
            width: 100%;
            transition: width 1s linear;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn-gold {
            background: linear-gradient(135deg, #d4af37 0%, #f9d423 100%);
            color: #1a1a2e;
            font-weight: 800;
            padding: 8px 16px;
            border-radius: 50px;
            transition: all 0.3s;
            text-transform: uppercase;
            box-shadow: 0 4px 12px rgba(249, 212, 35, 0.3);
            width: 100%;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.95rem;
        }

        .btn-gold:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(249, 212, 35, 0.5);
        }

        .btn-outline {
            background: transparent;
            color: #ffd700;
            border: 2px solid #ffd700;
            font-weight: 800;
            padding: 8px 16px;
            border-radius: 50px;
            transition: all 0.3s;
            width: 100%;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.95rem;
        }

        .btn-outline:hover:not(:disabled) {
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 0 12px rgba(255, 215, 0, 0.2);
        }

        .btn-gold:disabled, .btn-outline:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none !important;
        }

        .answer-box {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s ease-out;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
        }

        .answer-box.show {
            opacity: 1;
            transform: translateY(0);
        }

        .settings-panel {
            background: rgba(10, 10, 20, 0.98);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            display: none;
            padding: 40px;
            overflow-y: auto;
        }

        #end-screen {
            display: none;
            text-align: center;
            padding: 60px 40px;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 24px;
            border: 3px solid #ffd700;
            box-shadow: 0 0 60px rgba(255, 215, 0, 0.4);
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* åŠ åˆ†å‹•ç•«æ¨£å¼ */
        @keyframes scoreUp {
            0% { opacity: 0; transform: translateY(30px) scale(0.5); }
            20% { opacity: 1; transform: translateY(0) scale(1.2); }
            80% { opacity: 1; transform: translateY(-30px) scale(1); }
            100% { opacity: 0; transform: translateY(-60px); }
        }
        .animate-score-up {
            animation: scoreUp 1s ease-out forwards;
        }
    </style>
</head>
<body>

    <!-- èƒŒæ™¯éŸ³æ¨‚ -->
    <audio id="game-bgm" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>

    <!-- æ­¡å‘¼éŸ³æ•ˆ (ç³»çµ±éŸ³æ•ˆç¶²å€) -->
    <audio id="cheer-sfx">
        <source src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3" type="audio/mpeg">
    </audio>

    <div class="game-container" id="main-ui">
        <div class="text-center mb-5">
            <h1 class="text-4xl lg:text-5xl font-black text-yellow-400 tracking-widest drop-shadow-lg">é»‘å½±çŒœé¡Œ</h1>
        </div>

        <div class="flex flex-col lg:flex-row gap-6 items-stretch">
            
            <!-- å·¦å´ï¼šæ‹¼åœ–å€ (ä½”æ“šæ›´å¤§æ¯”ä¾‹) -->
            <div class="w-full lg:w-[72%] relative" id="game-board-container">
                <div class="puzzle-grid" id="puzzle-grid">
                    <div id="loading-overlay" class="loading-overlay text-xl lg:text-2xl">ç³»çµ±å•Ÿå‹•ä¸­...</div>
                    <div id="painting-bg" class="painting-bg"></div>
                </div>
            </div>

            <!-- å³å´ï¼šæ§åˆ¶å€ -->
            <div class="w-full lg:w-[28%] flex flex-col gap-4">
                
                <!-- è¨ˆæ™‚è³‡è¨Šèˆ‡éŸ³é‡æ§åˆ¶ -->
                <div class="bg-black bg-opacity-50 p-4 rounded-xl border border-gray-700">
                    <div class="flex justify-between items-center mb-2">
                        <span id="question-number" class="text-lg text-yellow-400 font-bold tracking-tight">è¼‰å…¥ä¸­...</span>
                        <div class="flex items-center gap-2">
                            <button onclick="toggleMute()" id="mute-btn" class="text-gray-400 hover:text-white transition">
                                <svg id="vol-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"/>
                                    <path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"/>
                                    <path d="M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182l-.707.707A3.489 3.489 0 0 1 9.025 8a3.489 3.489 0 0 1-1.025 2.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"/>
                                </svg>
                            </button>
                            <span id="timer-text" class="text-xl text-white font-mono font-bold">90s</span>
                        </div>
                    </div>
                    <div class="progress-bar-container">
                        <div id="progress-fill" class="progress-bar-fill"></div>
                    </div>
                </div>

                <!-- æ“ä½œæŒ‰éˆ• -->
                <div class="flex flex-col gap-3">
                    <button onclick="handleStartPause()" id="main-control-btn" class="btn-gold" disabled>è«‹ç¨å€™</button>
                    <button onclick="toggleAnswer()" id="toggle-answer-btn" class="btn-outline">é¡¯ç¤ºç­”æ¡ˆ</button>
                    <button onclick="nextQuestion()" class="btn-gold">ä¸‹ä¸€é¡Œ</button>
                </div>

                <!-- ç­”æ¡ˆå€åŸŸ -->
                <div id="answer-box" class="answer-box">
                    <h2 id="painting-name" class="text-2xl font-black text-white leading-tight"></h2>
                    <p id="artist-name" class="text-lg text-yellow-400 mt-1"></p>
                </div>

                <!-- è¨­å®šæŒ‰éˆ• -->
                <div class="mt-auto pt-4 flex justify-end">
                    <button onclick="openSettings()" class="text-gray-500 hover:text-gray-300 transition text-xs flex items-center gap-1">
                        <span>âš™ï¸ é¡Œåº«è¨­å®š</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- éŠæˆ²çµæŸç•«é¢ -->
    <div id="end-screen" class="max-w-2xl mx-auto">
        <h2 class="text-5xl font-black text-yellow-400 mb-6 tracking-widest">æ´»å‹•çµæŸ</h2>
        <p class="text-3xl font-bold text-white mb-8 italic">æ„Ÿè¬å¤§å®¶åƒåŠ ï¼</p>
        <div class="text-9xl mb-12 drop-shadow-xl">ğŸ™âœ¨ğŸŠ</div>
        <button onclick="location.reload()" class="btn-gold mx-auto max-w-[200px]">é‡æ–°é–‹å§‹</button>
    </div>

    <!-- è¨­å®šé¢æ¿ -->
    <div id="settings-panel" class="settings-panel">
        <div class="max-w-2xl mx-auto">
            <h2 class="text-3xl font-black mb-6 text-yellow-400 text-center">éŠæˆ²é¡Œåº«ç®¡ç†</h2>
            <div class="bg-gray-900 p-6 rounded-2xl mb-6 border border-gray-700 shadow-2xl">
                <p class="mb-4 text-gray-300">ä¸Šå‚³è‡ªå®šç¾©é¡Œç›®ï¼ˆæª”åå³ç‚ºç­”æ¡ˆï¼‰ï¼š</p>
                <input type="file" id="image-input" multiple accept="image/*" class="mb-4 block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-6 file:rounded-full file:border-0 file:text-sm file:font-bold file:bg-yellow-400 file:text-black hover:file:bg-yellow-500 cursor-pointer">
                <div class="text-xs text-gray-400 bg-black p-4 rounded-lg border border-gray-800 leading-relaxed">
                    ğŸ’¡ <span class="text-yellow-400 font-bold">è¦å‰‡èªªæ˜ï¼š</span><br>
                    â€¢ æª”åæ ¼å¼ï¼š<span class="text-white">ç­”æ¡ˆ-å‚™è¨».jpg</span> (å¦‚ï¼šå‰µé€ äºç•¶-ç±³é–‹æœ—åŸºç¾….jpg)<br>
                    â€¢ ä¸Šå‚³å¾Œæœƒæš«æ™‚å–ä»£ç›®å‰çš„å…§å»ºé¡Œç›®ã€‚
                </div>
            </div>
            <div id="file-list" class="grid grid-cols-1 gap-2 mb-6"></div>
            <div class="flex flex-col gap-3">
                <button onclick="applySettings()" class="btn-gold w-full text-lg">ğŸš€ å¥—ç”¨ä¸¦é–‹å§‹</button>
                <div class="flex gap-3">
                    <button onclick="useDefaultQuiz()" class="btn-outline flex-1">ğŸ”„ æ¢å¾©é è¨­</button>
                    <button onclick="closeSettings()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-8 rounded-full transition flex-1">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const defaultQuiz = [
            { name: "è’™å¨œéº—è", artist: "é”æ–‡è¥¿", url: "https://images.unsplash.com/photo-1544273677-277914c9ad31?q=80&w=1000" },
            { name: "æ˜Ÿå¤œ", artist: "æ¢µè°·", url: "https://images.unsplash.com/photo-1579783902614-a3fb3927b6a5?q=80&w=1000" },
            { name: "æˆ´çç è€³ç’°çš„å°‘å¥³", artist: "ç¶­æ¢…çˆ¾", url: "https://images.unsplash.com/photo-1582555172866-f73bb12a2ab3?q=80&w=1000" },
            { name: "å¶å–Š", artist: "è’™å…‹", url: "https://images.unsplash.com/photo-1605721911519-3dfeb3be25e7?q=80&w=1000" },
            { name: "ç¶­ç´æ–¯çš„èª•ç”Ÿ", artist: "æ³¢æåˆ‡åˆ©", url: "https://images.unsplash.com/photo-1578321272176-b7bbc0679b5d?q=80&w=1000" }
        ];

        let quizData = [...defaultQuiz];
        let currentIndex = 0;
        let timeLeft = 90;
        let timerInterval = null;
        let revealInterval = null;
        let unrevealedCells = [];
        let isGameStarted = false;
        let isPaused = false;
        let isImageLoaded = false;
        
        // éŸ³æ¨‚æ§åˆ¶
        const bgm = document.getElementById('game-bgm');
        const cheerSfx = document.getElementById('cheer-sfx');

        function toggleMute() {
            bgm.muted = !bgm.muted;
            cheerSfx.muted = bgm.muted;
            const icon = document.getElementById('vol-icon');
            if (bgm.muted) {
                icon.innerHTML = '<path d="M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06zm7.137 2.096a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 0 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0z"/>';
            } else {
                icon.innerHTML = '<path d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"/><path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"/><path d="M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182l-.707.707A3.489 3.489 0 0 1 9.025 8a3.489 3.489 0 0 1-1.025 2.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"/>';
            }
        }

        function openSettings() {
            document.getElementById('settings-panel').style.display = 'block';
            stopGame();
        }

        function closeSettings() {
            document.getElementById('settings-panel').style.display = 'none';
        }

        function useDefaultQuiz() {
            quizData = [...defaultQuiz];
            currentIndex = 0;
            closeSettings();
            initGrid();
        }

        function applySettings() {
            const input = document.getElementById('image-input');
            const files = input.files;
            if (files.length === 0) { alert("è«‹å…ˆé¸å–åœ–ç‰‡ï¼"); return; }

            quizData = [];
            for (let file of files) {
                const fileName = file.name.split('.').slice(0, -1).join('.');
                const parts = fileName.split('-');
                quizData.push({
                    name: parts[0] || "æœªå‘½å",
                    artist: parts[1] || "",
                    url: URL.createObjectURL(file)
                });
            }
            currentIndex = 0;
            closeSettings();
            initGrid();
        }

        function initGrid() {
            if (!quizData || quizData.length === 0) return;
            
            isImageLoaded = false;
            const grid = document.getElementById('puzzle-grid');
            const overlay = document.getElementById('loading-overlay');
            const bgElement = document.getElementById('painting-bg');
            const mainBtn = document.getElementById('main-control-btn');
            
            grid.classList.remove('reveal-all');
            overlay.style.display = 'flex';
            overlay.innerText = 'æ­£åœ¨è¼‰å…¥æ•¸æ“š...';
            bgElement.style.display = 'none';
            mainBtn.disabled = true;
            mainBtn.innerText = "è¼‰å…¥ä¸­";

            document.getElementById('painting-name').innerText = "";
            document.getElementById('artist-name').innerText = "";
            document.getElementById('answer-box').classList.remove('show');
            document.getElementById('toggle-answer-btn').innerText = "é¡¯ç¤ºç­”æ¡ˆ";

            const existingCells = grid.querySelectorAll('.mask-cell');
            existingCells.forEach(cell => cell.remove());

            unrevealedCells = [];
            for (let i = 0; i < 16; i++) {
                const cell = document.createElement('div');
                cell.className = 'mask-cell';
                cell.dataset.index = i;
                grid.appendChild(cell);
                unrevealedCells.push(i);
            }

            const current = quizData[currentIndex];
            const img = new Image();
            
            const timeout = setTimeout(() => {
                if(!isImageLoaded) {
                    overlay.innerText = 'é€£ç·šè¼ƒæ…¢ï¼Œå¯å¼·åˆ¶é–‹å§‹';
                    mainBtn.disabled = false;
                    mainBtn.innerText = "å¼·åˆ¶é–‹å§‹";
                }
            }, 8000);

            img.onload = () => {
                clearTimeout(timeout);
                bgElement.style.backgroundImage = `url('${current.url}')`;
                bgElement.style.display = 'block';
                overlay.style.display = 'none';
                isImageLoaded = true;
                mainBtn.disabled = false;
                mainBtn.innerText = "é–‹å§‹éŠæˆ²";
            };
            img.onerror = () => { 
                clearTimeout(timeout);
                overlay.innerText = 'åœ–ç‰‡è¼‰å…¥éŒ¯èª¤';
                mainBtn.disabled = false;
                mainBtn.innerText = "è·³éæ­¤é¡Œ";
            };
            img.src = current.url;

            document.getElementById('question-number').innerText = `ç¬¬ ${currentIndex + 1} é¡Œ / å…± ${quizData.length} é¡Œ`;
            isGameStarted = false;
            isPaused = false;
            stopIntervals();
            timeLeft = 90;
            updateTimerUI();
            
            // ä¸‹ä¸€é¡Œé–‹å§‹å‰ï¼Œç¢ºä¿éŸ³æ¨‚é‡ç½®åˆ°é–‹é ­
            bgm.currentTime = 0;
            bgm.pause();
        }

        function handleStartPause() {
            if (!isGameStarted) {
                isGameStarted = true;
                isPaused = false;
                startIntervals();
                revealRandomCell(); 
            } else {
                isPaused = !isPaused;
                if (isPaused) {
                    stopIntervals();
                    document.getElementById('main-control-btn').innerText = "ç¹¼çºŒéŠæˆ²";
                } else {
                    startIntervals();
                    document.getElementById('main-control-btn').innerText = "æš«åœ";
                }
            }
        }

        function startIntervals() {
            document.getElementById('main-control-btn').innerText = "æš«åœ";
            
            // è®€ç§’é–‹å§‹ï¼Œæ’­æ”¾éŸ³æ¨‚
            bgm.play().catch(e => console.log("ç­‰å¾…äº’å‹•æ’­æ”¾éŸ³æ¨‚"));

            timerInterval = setInterval(() => {
                if (timeLeft > 0) { 
                    timeLeft--; 
                    updateTimerUI(); 
                } else { 
                    stopGame(); 
                }
            }, 1000);
            revealInterval = setInterval(() => { revealRandomCell(); }, 5000);
        }

        function stopIntervals() {
            clearInterval(timerInterval);
            clearInterval(revealInterval);
            
            // è®€ç§’æš«åœæˆ–åœæ­¢ï¼ŒéŸ³æ¨‚æš«åœ
            bgm.pause();
        }

        function updateTimerUI() {
            const percentage = (timeLeft / 90) * 100;
            document.getElementById('progress-fill').style.width = `${percentage}%`;
            document.getElementById('timer-text').innerText = `${timeLeft}s`;
        }

        function revealRandomCell() {
            if (unrevealedCells.length === 0) return;
            const randomIndex = Math.floor(Math.random() * unrevealedCells.length);
            const cellIndex = unrevealedCells.splice(randomIndex, 1)[0];
            const cell = document.querySelector(`.mask-cell[data-index="${cellIndex}"]`);
            if (cell) cell.classList.add('revealed');
        }

        function toggleAnswer() {
            const box = document.getElementById('answer-box');
            const btn = document.getElementById('toggle-answer-btn');
            const grid = document.getElementById('puzzle-grid');

            if (!box.classList.contains('show')) {
                const current = quizData[currentIndex];
                document.getElementById('painting-name').innerText = current.name;
                document.getElementById('artist-name').innerText = current.artist;
                box.classList.add('show');
                btn.innerText = "éš±è—ç­”æ¡ˆ";
                grid.classList.add('reveal-all');
            } else {
                box.classList.remove('show');
                btn.innerText = "é¡¯ç¤ºç­”æ¡ˆ";
                grid.classList.remove('reveal-all');
            }
        }

        function showScoreEffect(points) {
            const board = document.getElementById('puzzle-grid');
            const scoreEl = document.createElement('div');
            scoreEl.className = 'absolute inset-0 flex items-center justify-center z-[100] pointer-events-none';
            scoreEl.innerHTML = `<span class="text-6xl lg:text-8xl font-black text-yellow-400 drop-shadow-[0_0_20px_rgba(0,0,0,0.8)] animate-score-up">+${points}åˆ†</span>`;
            board.appendChild(scoreEl);
            
            // æ’­æ”¾æ­¡å‘¼è² (ç´„2ç§’)
            cheerSfx.currentTime = 0;
            cheerSfx.play().catch(e => console.log("ç­‰å¾…äº’å‹•æ’­æ”¾éŸ³æ•ˆ"));
            
            setTimeout(() => scoreEl.remove(), 1000);
        }

        function stopGame() {
            isGameStarted = false;
            isPaused = false;
            stopIntervals();
            document.getElementById('main-control-btn').innerText = "é–‹å§‹éŠæˆ²";
        }

        function nextQuestion() {
            const currentScore = unrevealedCells.length;
            stopIntervals(); // éŸ³æ¨‚æœƒåœ¨æ­¤æš«åœ
            
            // åœ¨é¡¯ç¤ºåŠ åˆ†å‹•ç•«æ™‚ï¼Œé‡ç½®èƒŒæ™¯éŸ³æ¨‚ä½ç½®
            bgm.currentTime = 0;
            
            showScoreEffect(currentScore);

            setTimeout(() => {
                if (currentIndex >= quizData.length - 1) {
                    showEndScreen();
                    return;
                }
                currentIndex++;
                initGrid();
            }, 800);
        }

        function showEndScreen() {
            document.getElementById('main-ui').style.display = 'none';
            document.getElementById('end-screen').style.display = 'block';
            
            // çµæŸç•«é¢éŸ³æ¨‚å¾¹åº•åœæ­¢ä¸¦æ­¸é›¶
            bgm.pause();
            bgm.currentTime = 0;
        }

        document.getElementById('image-input').addEventListener('change', function(e) {
            const list = document.getElementById('file-list');
            list.innerHTML = "";
            Array.from(e.target.files).forEach((file, index) => {
                const item = document.createElement('div');
                item.className = "text-sm text-gray-400 bg-black p-3 rounded-lg border border-gray-800 flex items-center";
                item.innerHTML = `<span class="bg-yellow-400 text-black px-2 py-0.5 rounded font-black mr-3">${index + 1}</span> åœ–ç‰‡å·²å°±ç·’`;
                list.appendChild(item);
            });
        });

        window.addEventListener('load', () => {
            initGrid();
        });
    </script>
</body>
</html>